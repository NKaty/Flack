{% extends "base.html" %}

{% block title %}Channels - Chat{% endblock %}

{% block page_content %}
<div class="chat-container" id="chat-container">
    <div class="chat-section channels">
        <div class="fixed-header position-fixed">
            <h3>Channels</h3>
            <button id="create-channel" data-toggle="modal" data-target="#create-channel-modal">
                Create channel
            </button>
        </div>
        <ul id="channels"></ul>
        <div id="channels-sentinel" class="sentinel d-flex justify-content-center mt-2">
            <!--            <div class="spinner-border text-secondary" id="channels-spinner" role="status">-->
            <!--                <span class="sr-only">Loading...</span>-->
            <!--            </div>-->
        </div>
    </div>
    <div class="chat-section messages">
        <div id="messages-sentinel" class="sentinel d-flex justify-content-center mb-2">
            <div class="spinner-border text-secondary" id="messages-spinner" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div id="messages-area">
            <div id="messages">
                {% if not user.channel_id %}
                <p>Select channel or create your own channel to start messaging</p>
                {% endif %}
            </div>
            <form class="form-inline {{ 'd-none' if not user.channel_id }}" id="send-message">
                <div class="form-group mx-sm-3 mb-2">
                    <textarea name="message" class="form-control"></textarea>
                </div>
                <button type="button" class="btn btn-primary mb-2">Send</button>
            </form>
        </div>
    </div>
    <div class="chat-section members">
        <h3 class="fixed-header position-fixed">Members</h3>
        <ul id="members"></ul>
        <div id="members-sentinel" class="sentinel d-flex justify-content-center mt-2">
            <!--            <div class="spinner-border text-secondary" id="members-spinner" role="status">-->
            <!--                <span class="sr-only">Loading...</span>-->
            <!--            </div>-->
        </div>
    </div>
</div>

<div class="modal fade" id="create-channel-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title">Create channel</h5>
            </div>
            <form name="create-channel">
                <div class="modal-body">
                    <div class="form-group">
                        <div class="input-group">
                            <input class="form-control" name="channel" placeholder="Channel name">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close
                    </button>
                    <button type="button" id="submit" class="btn btn-info" data-dismiss="modal"
                            disabled>Submit
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% raw %}

<script id="flash-template" type="text/x-handlebars-template">
    {{#each .}}
    <div class="alert alert-{{category}} alert-dismissible fade show" role="alert">
        {{message}}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {{/each}}
</script>

<script id="channels-template" type="text/x-handlebars-template">
    {{#each channels}}
    <li class="{{#if_eq this ../activeChannel}}active{{/if_eq}}" data-channel="{{this}}">
        {{this}}
    </li>
    {{/each}}
</script>

<script id="members-template" type="text/x-handlebars-template">
    {{#each .}}
    <li>{{this}}</li>
    {{/each}}
</script>

<script id="messages-template" type="text/x-handlebars-template">
    {{#each .}}
    <div class="message">
        <span>{{author}}</span>
        <span>{{timestamp}}</span>
        <div>{{text}}</div>
    </div>
    {{/each}}
</script>

{% endraw %}

{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.3/handlebars.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver"></script>
<script src="{{ url_for('static', filename='sockets.js') }}"></script>
{% endblock %}